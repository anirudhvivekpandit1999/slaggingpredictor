<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.plot.ly/plotly-3.0.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-size: large;
            font-family: Arial, sans-serif;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            /* or space-evenly */
            width: 100%;
            background-color: #f7f8fa;
            align-items: center;
            padding: 15px 20px;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            height: 65px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .navbar img {
            height: 95px;
            margin-right: 20px;
            margin-left: 0px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            /* Use 'gap' for spacing between flex items */
            margin-right: 20px;

        }

        .navbar h1 {
            margin-left: 0px;
            font-size: 20px;
            /* Adjust font size as needed */
            color: black;

        }

        .navbar button {
            padding: 10px 15px;
            background-color: #02008a;
            color: #ffffff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-right: 20px;
            font-weight: bold;
        }

        .navbar button:hover {
            background-color: #001cbb;
        }

        .logout-button {
            background-color: red !important;
            margin-right: 30px;
        }

        .logout-button:hover {
            background-color: darkred !important;
        }

        .content {
            margin-top: 90px;
            /* Space below navbar */
            padding: 10px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin-left: 50px;
            margin-right: 50px;
            height: auto;
        }

        .blend-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .blend {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
            width: 100%;
        }

        .blend select,
        .blend-entry select,
        .blend input,
        .blend-entry input {
            flex: 2;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            background-color: #02008a;
            color: white;
            border-radius: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
            margin-bottom: 15px;
        }

        /* Table Header */
        table th {
            background: #0153ac;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            border: 1px solid #ddd;
        }

        /* Table Rows */
        table td {
            padding: 10px;
            text-align: center;
            font-size: 14px;
            border: 1px solid #ddd;
            color: #333;
        }

        /* Alternate Row Background */
        table tr:nth-child(even) {
            background: #f2f2f2;
        }

        /* Hover Effect */
        table tr:hover {
            background: #d4e6ff;
        }


        /* Light blue background for table headers */
        th[colspan="3"] {
            background-color: rgb(24, 0, 158);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 30%;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .close {
            font-size: 30px;
            cursor: pointer;
            font-weight: bolder;
        }

        .blendedcoalProperties {
            overflow-x: auto;
            margin-top: 10px;
            white-space: nowrap;
            padding: 10px;
        }

        .blendedcoalProperties p {
            display: inline-block;
            margin-right: 20px;
            padding: 5px;
            border: 1px solid #ccc;
        }

        .blendedcoalProperties::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .blendedcoalProperties::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 5px;
        }

        .blendedcoalProperties::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }

        .blend .remove-blend-btn,
        .blend-entry .remove-blend-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .blend .remove-blend-btn:hover,
        .blend-entry .remove-blend-btn:hover {
            background-color: #c0392b;
        }

        .add-blend-btn {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            width: 20%;
            margin-left: 40%;
            background-color: #02008a;
            margin-bottom: 20px;
            margin-top: 20px;
            color: white;
            border-radius: 5px;
        }

        .calculate-btn {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            background-color: #02008a;
            width: 20%;
            margin-left: 40%;
            margin-top: 20px;

            color: white;
            border-radius: 5px;
        }

        #optimization-result {
            display: none;
        }

        .individual-aft-table {
            width: 50%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
            font-size: 14px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .individual-aft-table th {
            background-color: #004a99;
            color: white;
            padding: 10px;
            text-align: left;
        }

        .individual-aft-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        .individual-aft-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .individual-aft-table tr:hover {
            background-color: #f1f1f1;
        }

        .individual-aft-heading {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <img src="/images/abhitech-logo.png" alt="Company Logo">
        <h1>Combustion Analyzer</h1>
        <div class="nav-buttons">
            <button onclick="window.location.href='coal_table.html'">Coal Properties</button>
            <button onclick="window.location.href='slagging_coal_page.html'">Calculation</button>

        </div>
    </div>

    <div class="content">
        <form id="coalForm">
            <div id="coalBlends">
                <h2>Coal Type</h2>
                <div class="blend-row"></div>
            </div>
            <button type="button" class="add-blend-btn" onclick="addBlend()">Add Coal</button>
            <div id="totalRangeContainer">
                <label>Total Current Range:<span id="totalRange"></span>%</label>
            </div>
            <button type="button" class="calculate-btn" onclick="optimizeBlend()">Calculate</button>
        </form>


        <div id="coalPropertiesModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Elemental Analysis</h3>
                    <span class="close" onclick="closeModal()">&times;</span>
                </div>
                <div id="coalPropertiesContent"></div>
            </div>
        </div>
        <div id="optimization-result"></div>


        <script>
            function addBlend() {
                const MAX_COALS = 5;
                const currentCoals = document.querySelectorAll('.blend').length;

                if (currentCoals >= MAX_COALS) {
                    alert("You can only add up to 5 coal types.");
                    return;
                }

                const index = currentCoals;
                const blendDiv = document.createElement("div");
                blendDiv.className = "blend";
                blendDiv.innerHTML = `
            <label for="coal${index}">Coal:</label>
            <select name="coal${index}" id="coal${index}">
                <option value="">Select Coal Type</option>
            </select>
            <input type="number" id="currentrange${index}" placeholder="Current Range (%)">
            <input type="number" id="minrange${index}" placeholder="Min Range (%)">
            <input type="number" id="maxrange${index}" placeholder="Max Range (%)">
            <input type="number" id="cost${index}" placeholder="Cost (Rs.)">
            
            <button type="button" class="remove-blend-btn" onclick="removeBlend(this)">X</button>
            <button type="button" class="properties-btn" onclick="fetchCoalProperties(${index})">Properties</button>
            <div id="properties${index}"></div>
        `;

                const currentRangeInput = blendDiv.querySelector(`#currentrange${index}`);
                currentRangeInput.addEventListener("input", updateTotalRange);

                const blendRow = document.querySelector(".blend-row");

                // Append the new blendDiv to the blendRow
                blendRow.appendChild(blendDiv); // This will add it to the end

                populateDropdown(blendDiv.querySelector(`#coal${index}`));
                updateTotalRange();
            }

            function updateTotalRange() {
                totalCurrentRange = 0;
                const ranges = document.querySelectorAll('input[id^="currentrange"]');
                ranges.forEach(range => {
                    const rangeValue = parseFloat(range.value) || 0;
                    totalCurrentRange += rangeValue;
                });
                document.getElementById("totalRange").textContent = totalCurrentRange;

            }

            function removeBlend(button) {
                button.parentElement.remove();
            }

            document.addEventListener('DOMContentLoaded', () => {

                fetch(`/get_coal_types`)
                    .then(response => response.json())
                    .then(data => {
                        window.coalData = data.coal_data;
                        addBlend();
                    })
                    .catch(error => console.error('Error fetching coal types:', error));
            });


            function populateDropdown(selectElement) {
                selectElement.innerHTML = '<option value="">Select Coal Type</option>';
                window.coalData.forEach(coal => {
                    const opt = document.createElement('option');
                    opt.value = coal.id;            // <-- hidden unique key
                    opt.textContent = coal.transportId
                        ? `${coal.coalType} – ${coal.transportId}`
                        : coal.coalType;
                    selectElement.appendChild(opt);
                });
            }


            function fetchCoalProperties(index) {
                const selectedCoal = document.querySelector(`#coal${index}`).value;

                if (!selectedCoal) {
                    alert("Please select a coal type first.");
                    return;
                }

                const coalInfo = window.coalData.find(coal => coal.id === selectedCoal);
                if (!coalInfo) {
                    alert("Properties not found.");
                    return;
                }

                // Generate table HTML
                let propertiesHTML = `
            <table border="1" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="padding: 8px; border: 1px solid lightgray;">Percentage Properties</th>
                        <th style="padding: 8px; border: 1px solid lightgray;">Value</th>
                    </tr>
                </thead>
                <tbody>
        `;


                for (const [key, value] of Object.entries(coalInfo.properties)) {
                    propertiesHTML += `
                <tr>
                    <td style="padding: 8px; border: 1px solid lightgray;">${key}</td>
                    <td style="padding: 8px; border: 1px solid lightgray;">${value}</td>
                </tr>
            `;
                }

                propertiesHTML += `</tbody></table>`;

                document.getElementById("coalPropertiesContent").innerHTML = propertiesHTML;
                document.getElementById("coalPropertiesModal").style.display = "block";
            }

            function closeModal() {
                document.getElementById("coalPropertiesModal").style.display = "none";
            }

            window.onclick = function (event) {
                const modal = document.getElementById("coalPropertiesModal");
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            };

            function optimizeBlend() {
                const blends = [];

                let totalCurrentRange = 0;
                const ranges = document.querySelectorAll('input[id^="currentrange"]');

                ranges.forEach(range => {
                    const rangeValue = parseFloat(range.value) || 0;
                    totalCurrentRange += rangeValue;
                });

                if (totalCurrentRange !== 100) {
                    alert("Total percentage must be exactly 100 to proceed!");
                    return;
                }

                document.querySelectorAll(".blend").forEach((blendDiv, index) => {
                    const selectedId = document.querySelector(`#coal${index}`).value;
                    const min = parseFloat(document.querySelector(`#minrange${index}`).value) || 0;
                    const max = parseFloat(document.querySelector(`#maxrange${index}`).value) || 0;
                    const cost = parseFloat(document.querySelector(`#cost${index}`).value) || 0;
                    const current = parseFloat(document.querySelector(`#currentrange${index}`).value) || 0;

                    const coalInfo = window.coalData.find(coal => coal.id === selectedId);
                    if (!coalInfo) return;

                    blends.push({
                        id: selectedId,
                        coal: coalInfo.coalType,
                        current,
                        min,
                        max,
                        cost,
                        properties: {
                            SiO2: coalInfo.properties["SiO₂"] || 0,
                            Al2O3: coalInfo.properties["Al₂O₃"] || 0,
                            Fe2O3: coalInfo.properties["Fe₂O₃"] || 0,
                            CaO: coalInfo.properties["CaO"] || 0,
                            MgO: coalInfo.properties["MgO"] || 0,
                            Na2O: coalInfo.properties["Na₂O"] || 0,
                            K2O: coalInfo.properties["K₂O"] || 0,
                            SO3: coalInfo.properties["SO₃"] || 0,
                            TiO2: coalInfo.properties["TiO₂"] || 0,
                            Gcv: coalInfo.properties["GCV"] || 0
                        }
                    });
                });

                console.log("Blends data:", blends);

                document.getElementById("coalForm").style.display = "none";
                document.getElementById("optimization-result").style.display = "block";

                fetch(`/optimize`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ blends })
                })
                    .then(res => res.json())
                    .then(data => {
                        console.log("Optimization Result:", data);
                        displayOptimizationResult(data, blends);
                        displayScaleBars(data); // Call to display scale bars dynamically
                    })
                    .catch(err => console.error("Error optimizing blend:", err));
            }
            function displayOptimizationResult(data, blends) {
                const bestAftBlend = data.best_aft_blend;
                const cheapestBlend = data.cheapest_blend;
                const balancedBlend = data.balanced_blend;
                const currentBlend = data.current_blend;


                const coalTypes = blends.map(b => b.coal);

                const blendsWithAFT = [
                    { label: "Best AFT", blend: bestAftBlend.blend, predicted_aft: bestAftBlend.predicted_aft, coals: blends },
                    { label: "Cheapest", blend: cheapestBlend.blend, predicted_aft: cheapestBlend.predicted_aft, coals: blends },
                    { label: "Balanced", blend: balancedBlend.blend, predicted_aft: balancedBlend.predicted_aft, coals: blends }
                ];

                const tableHtml = `
            <table>
                <tr>
                    <th>Coal type</th>
                    <th>Current Blend</th>
                    <th>Best Blend</th>
                    <th>Best Price Blend</th>
                    <th>Balanced Blend</th>
                </tr>
                ${blends.map((blend, i) => {
                    const bestAftPct = bestAftBlend.blend[i];
                    const cheapestPct = cheapestBlend.blend[i];
                    const balancedPct = balancedBlend.blend[i];
                    const currentPct = currentBlend.blend[i];

                    return `
                        <tr>
                            <td>${blend.coal}</td>
                            <td>${currentPct}</td>
                            <td>${bestAftPct}%</td>
                            <td>${cheapestPct}%</td>
                            <td>${balancedPct}%</td>
                        </tr>
                    `;
                }).join('')}
                <tr>
                    <td>AFT (°C)</td>
                    <td>${currentBlend.predicted_aft.toFixed(2)}</td>
                    <td>${bestAftBlend.predicted_aft.toFixed(2)}</td>
                    <td>${cheapestBlend.predicted_aft.toFixed(2)}</td>
                    <td>${balancedBlend.predicted_aft.toFixed(2)}</td>
                </tr>
                <tr>
                    <td>GCV</td>
                    <td>${currentBlend.gcv.toFixed(2)}</td>
                    <td>${bestAftBlend.gcv.toFixed(2)}</td>
                    <td>${cheapestBlend.gcv.toFixed(2)}</td>
                    <td>${balancedBlend.gcv.toFixed(2)}</td>
                </tr>
                <tr>
                    <td>Cost (Rs.)</td>
                    <td>${currentBlend.cost.toFixed(2)}</td>
                    <td>${bestAftBlend.cost.toFixed(2)}</td>
                    <td>${cheapestBlend.cost.toFixed(2)}</td>
                    <td>${balancedBlend.cost.toFixed(2)}</td>
                </tr>
            </table>
            <div style="margin-top: 20px;">
                <button onclick="window.location.reload()">Back</button>
            </div>
        `;


                // Display individual coal AFTs
                const individualTable = `
            <h3>Individual Coal AFTs</h3>
            <table>
                <tr>
                    <th>Coal Type</th>
                    <th>Predicted AFT (°C)</th>
                </tr>
                ${data.individual_coal_afts.map(coal => `
                    <tr>
                        <td>${coal.coal}</td>
                        <td>${coal.predicted_aft.toFixed(2)}</td>
                    </tr>
                `).join('')}
            </table>
        `;

                document.getElementById("optimization-result").innerHTML = `
        <div style="width: 100%; margin-bottom: 30px;">
            ${tableHtml}
         
        </div>
     
        <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-start;">
            <div style="flex: 1; min-width: 400px; padding: 20px;">
                <div id="ternary-plot" style="width: 100%; height: 500px;"></div>
            </div>
            <div style="flex: 1;">
                ${individualTable}
            </div>
        </div>
    `;

                updatePlot(blendsWithAFT);

            }

            function updatePlot(blendsWithAFT) {
                const ternaryPlotElement = document.getElementById('ternary-plot');
                if (!ternaryPlotElement) {
                    console.error("Ternary plot element #ternary-plot not found.");
                    return;
                }

                const a = [];  // Acidic
                const b = [];  // Basic
                const c = [];  // Other
                const colors = [];  // AFTs
                const labels = [];  // For hover

                blendsWithAFT.forEach(blend => {
                    let acidic = 0, basic = 0, other = 0;
                    let totalPercentage = 0;

                    blend.blend.forEach((pct, i) => {
                        const coal = blend.coals[i];
                        const props = coal.properties;
                        const weight = pct;

                        totalPercentage += weight;

                        if (props) {
                            acidic += weight * ((props.SiO2 || 0) + (props.Al2O3 || 0) + (props.TiO2 || 0));
                            basic += weight * ((props.CaO || 0) + (props.MgO || 0) + (props.Na2O || 0) + (props.K2O || 0));
                            other += weight * ((props.Fe2O3 || 0) + (props.SO3 || 0) + (props.P2O5 || 0) + (props.Mn3O4 || 0));
                        }
                    });

                    // Normalize to percentages
                    a.push(acidic / totalPercentage);
                    b.push(basic / totalPercentage);
                    c.push(other / totalPercentage);
                    colors.push(blend.predicted_aft);
                    labels.push(`${blend.label} - AFT: ${blend.predicted_aft.toFixed(2)}°C`);
                });

                const data = [{
                    type: 'scatterternary',
                    mode: 'markers',
                    a,
                    b,
                    c,
                    marker: {
                        size: 14,
                        color: colors,
                        colorscale: 'Jet',
                        colorbar: { title: "Fusion Temp (°C)" }
                    },
                    text: labels,
                    hoverinfo: 'text'
                }];

                const layout = {
                    margin: { l: 40, r: 40, t: 60, b: 50 },
                    ternary: {
                        sum: 100,
                        aaxis: { title: { text: "Thermal Stability", font: { size: 14 } }, showticklabels: true },
                        baxis: { title: { text: "Fusion Accelerator", font: { size: 14 } }, showticklabels: true },
                        caxis: { title: { text: "Hardening Index", font: { size: 14 } }, showticklabels: true }
                    }
                };

                Plotly.newPlot(ternaryPlotElement, data, layout);
            }

            function createHorizontalScaleBar(containerId, totalScore, checkboxScore, overallTotal) {
                const minValue = 0;
                const maxValue = 10;

                const container = document.getElementById(containerId);
                container.innerHTML = ""; // Clear previous content

                const barWrapper = document.createElement("div");
                barWrapper.style.width = "100%";
                barWrapper.style.height = "32px";
                barWrapper.style.border = "1px solid black";
                barWrapper.style.borderRadius = "12px";
                barWrapper.style.position = "relative";
                barWrapper.style.display = "flex";

                let sfWidth = (totalScore / maxValue) * 100;
                sfWidth = sfWidth > 100 ? 100 : sfWidth;

                let cbWidth = ((totalScore + checkboxScore) > maxValue)
                    ? Math.max(0, (maxValue - totalScore) / maxValue * 100)
                    : (checkboxScore / maxValue) * 100;

                const totalCombined = totalScore + checkboxScore;

                const sfBar = document.createElement("div");
                sfBar.style.height = "100%";
                sfBar.style.width = `${sfWidth}%`;
                sfBar.style.borderRadius = totalCombined >= maxValue ? "12px" : "12px 0 0 12px";
                sfBar.style.backgroundColor = getColor(totalScore);

                const cbBar = document.createElement("div");
                cbBar.style.height = "100%";
                cbBar.style.width = `${cbWidth}%`;
                cbBar.style.borderRadius = totalCombined >= maxValue ? "0 12px 12px 0" : "0";
                cbBar.style.backgroundColor = getCheckboxBaseColor(totalScore);
                cbBar.style.backgroundImage = getHatchingLines(getHatchColor(totalCombined));

                barWrapper.appendChild(sfBar);
                barWrapper.appendChild(cbBar);

                for (let i = minValue; i <= maxValue; i++) {
                    const tick = document.createElement("div");
                    tick.style.position = "absolute";
                    tick.style.left = `${(i / maxValue) * 100}%`;
                    tick.style.top = "50%";
                    tick.style.transform = "translateY(-50%)";
                    tick.style.height = "10px";
                    tick.style.width = "1px";
                    tick.style.backgroundColor = "black";

                    const label = document.createElement("span");
                    label.style.position = "absolute";
                    label.style.marginTop = "5px";
                    label.style.left = `${(i / maxValue) * 100}%`;
                    label.style.top = "100%";
                    label.style.transform = "translateX(-50%)";
                    label.style.fontSize = "12px";
                    label.textContent = i;

                    barWrapper.appendChild(tick);
                    barWrapper.appendChild(label);
                }

                container.appendChild(barWrapper);
            }

            function getColor(score) {
                if (score < 3) return "#a6e3a6";
                if (score < 6.5) return "yellow";
                return "red";
            }

            function getCheckboxBaseColor(score) {
                if (score < 3) return "#5de65d";
                if (score < 6.5) return "#fddf05";
                return "#e24242";
            }

            function getHatchColor(totalCombined) {
                if (totalCombined > 6.5) return "red";
                if (totalCombined > 3) return "yellow";
                return "green";
            }

            function getHatchingLines(hatchColor) {
                return `repeating-linear-gradient(45deg, transparent, transparent 5px, ${hatchColor} 5px, ${hatchColor} 10px)`;
            }

            function displayScaleBars(data) {
                const { best_aft_blend, cheapest_blend, balanced_blend, current_blend } = data;

                const tableElement = document.querySelector("#optimization-result table");
                if (!tableElement) {
                    console.error("Table element not found. Cannot render scale bars.");
                    return;
                }

                const scaleBarsContainer = document.createElement("div");
                scaleBarsContainer.id = "scaleBarsContainer";
                scaleBarsContainer.style.marginTop = "20px";
                scaleBarsContainer.style.width = "100%";

                tableElement.parentNode.insertBefore(scaleBarsContainer, tableElement.nextSibling);

                scaleBarsContainer.innerHTML = ""; // Clear previous content

                const blends = [
                    { id: "bestAftScaleBar", label: "Best Blend", blend: best_aft_blend },
                    { id: "cheapestScaleBar", label: "Best Price Blend", blend: cheapest_blend },
                    { id: "balancedScaleBar", label: "Balanced Blend", blend: balanced_blend },
                    { id: "currentScaleBar", label: "Current Blend", blend: current_blend }
                ];

                blends.forEach(({ id, label, blend }) => {
                    const container = document.createElement("div");
                    container.style.marginBottom = "10px";
                    container.style.display = "flex";
                    container.style.alignItems = "center";

                    const title = document.createElement("div");
                    title.textContent = label;
                    title.style.width = "150px";
                    title.style.fontWeight = "bold";
                    title.style.marginRight = "10px";

                    const barWrapper = document.createElement("div");
                    barWrapper.id = id;
                    barWrapper.style.width = "100%";
                    barWrapper.style.height = "32px";
                    barWrapper.style.border = "1px solid black";
                    barWrapper.style.borderRadius = "12px";
                    barWrapper.style.position = "relative";
                    barWrapper.style.display = "flex";

                    const valueDisplay = document.createElement("div");
                    valueDisplay.style.position = "absolute";
                    valueDisplay.style.top = "50%";
                    valueDisplay.style.left = "50%";
                    valueDisplay.style.transform = "translate(-50%, -50%)";
                    valueDisplay.style.fontWeight = "bold";
                    valueDisplay.style.fontSize = "14px";
                    valueDisplay.textContent = `${blend.totalScore || 0}`;

                    barWrapper.appendChild(valueDisplay);
                    container.appendChild(title);
                    container.appendChild(barWrapper);
                    scaleBarsContainer.appendChild(container);

                    createHorizontalScaleBar(id, blend.totalScore || 0, blend.checkboxScore || 0, blend.overallTotal || 0);
                });
            }

            document.addEventListener('DOMContentLoaded', () => {
                const tableElement = document.querySelector("#optimization-result table");
                const scaleBarsContainer = document.createElement("div");
                scaleBarsContainer.id = "scaleBarsContainer";
                scaleBarsContainer.style.marginTop = "20px";
                scaleBarsContainer.style.width = "100%";

                if (tableElement) {
                    tableElement.parentNode.insertBefore(scaleBarsContainer, tableElement.nextSibling);
                } else {
                    console.error("Table element not found. Cannot render scale bars.");
                    return;
                }

                document.body.style.overflow = "hidden"; // Prevent scrolling
                document.body.style.height = "100vh"; // Fit content to screen height
                document.body.style.display = "flex";
                document.body.style.flexDirection = "column";
                document.body.style.justifyContent = "space-between"; // Stretch content to fit screen
            });
        </script>



</body>

</html>